You have an approved implementation plan: . You are implementing ONLY Phase 1 of the approved implementation plan.

Stack:

- FastAPI backend
- Jinja2 server-rendered UI
- pytest >= 8
- pytest-asyncio (asyncio_mode=auto)
- pytest-cov >= 6
- Snyk is enabled in Cursor and must report ZERO issues for changed code / dependencies.

Non-negotiable rules:

1) Implement ONLY this plan step. No scope creep.
2) Preserve all existing functionality (fractional CTO flow must remain intact).
3) All tests must pass, including:
   - All new tests written for this step
   - All existing tests
4) Coverage:
   - Overall coverage must remain >= 75%
   - Coverage for newly modified modules must be >= 85%
5) Codebase cleanliness:
   - ZERO warnings allowed (pytest/runtime/deprecations/async/DB/FastAPI/etc.)
   - ZERO linter errors (must be clean)
   - ZERO Snyk issues introduced or present in changed areas
6) Do NOT modify tests unless objectively incorrect.
7) Do NOT remove/weaken assertions.
8) Do NOT skip tests or silence warnings to get green.
9) Do not delete legacy code until compatibility layer is proven via passing tests.

Warning enforcement (must be clean):

- Run pytest with warnings treated as errors.
- Fix root causes of any warning (do not blanket-suppress).
- Only allow targeted suppression for unavoidable third-party warnings, with a comment and issue reference.

Security enforcement (Snyk):

- Do not introduce new vulnerable dependencies.
- Do not ignore or waive findings without explicit justification.
- If Snyk flags an issue, fix it by:
  - upgrading dependency, or
  - removing dependency, or
  - changing implementation to avoid the vulnerable path
- Document any remediation in the PR summary.

No-linter-errors requirement:

- Ensure formatting, imports, and style are consistent with repo conventions.
- If the repo uses Ruff/Flake8/Black/isort/etc., run the configured commands and ensure zero errors.

Invariant enforcement (must remain true; fix if tests expose violations):

- workspace_id scoping enforced where applicable
- pack_id scoping enforced where applicable
- ESL hard bans cannot be bypassed
- Idempotency where required (reruns don’t duplicate)
- No cross-tenant leakage
- No raw observation text passed to LLM by default

Verification commands (must be provided in output):

- pytest tests/ -v -W error
- pytest tests/ -v --cov=app --cov-report=term-missing --cov-fail-under=75 -W error
- pytest tests/ -v -m integration -W error (if integration tests exist/changed)
- Run repo’s linter command(s) and show they are clean (zero errors)
- Run Snyk (or confirm Cursor Snyk panel is clean) — zero issues

Output format:

1) Step implemented (from approved plan)
2) Summary of code changes (1–2 paragraphs)
3) Files modified (paths)
4) Migrations added/changed (if any)
5) How failing tests are now satisfied (tie to specific tests)
6) Verification results:
   - Tests: pass
   - Coverage: >= 75% overall; >= 85% for modified modules
   - Warnings: none
   - Linter: zero errors
   - Snyk: zero issues
7) Risk assessment (what could still break, if anything)

If you discover the plan is insufficient to make tests pass CLEANLY:

- Stop.
- Explain what is missing.
- Propose the minimal plan adjustment.
- Do NOT redesign architecture.

Proceed with implementing ONLY this phase.
